<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ product.name }} - Toys | Sona Enterprises</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    /* AMAZON-LIKE LAYOUT */
    .product-page {
      background: #f8fafc;
    }

    /* Left image box */
    .image-box {
      background: #fff;
      border: 1px solid #e6e9ee;
      border-radius: 10px;
      padding: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-box img {
      max-width: 100%;
      max-height: 620px;
      object-fit: contain;
    }

    /* Thumbnail column (kept hidden if single image) */
    .thumb {
      width: 64px;
      height: 64px;
      border: 1px solid #e6e9ee;
      border-radius: 6px;
      padding: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: #fff;
    }
    .thumb img { max-width: 100%; max-height: 100%; object-fit: contain; }

    /* Buy box */
    .buy-box {
      position: relative;
    }

    /* Description / About this item */
    .description-section {
      background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
      border-left: 4px solid #2563eb;
      border-radius: 12px;
    }
    .description-content > * + * { margin-top: 16px; }
    .desc-heading { font-size: 18px; font-weight: 700; color: #0f172a; display:block; margin-top:10px; }
    .desc-paragraph { color: #475569; line-height: 1.8; font-size: 14px; }
    .desc-list { margin: 8px 0 8px 1rem; padding-left: 0; }
    .desc-list li { margin-bottom: 8px; color: #374151; line-height: 1.6; }

    /* Responsive tweaks */
    @media (min-width: 768px) {
      .image-box img { max-height: 620px; }
    }

    /* small utilities for amazon-like feel */
    .small-pill { background: #eef2ff; color: #3730a3; padding: 6px 10px; border-radius: 999px; font-weight:600; font-size:12px; display:inline-block }
    .muted { color: #6b7280; }

    /* recommended carousel item */
    .related-card img { object-fit: contain; padding: 12px; background: #fbfdff; }

    /* Buttons color for toys can use accent but layout same as electronics */
    .toy-cta { background: linear-gradient(90deg,#ec4899,#fb7185); }
  </style>
</head>
<body class="product-page">
  {% include 'nav.html' %}

  <section class="py-8 md:py-12">
    <div class="container mx-auto px-4 md:px-6 lg:px-20">
      <!-- TOP: product gallery + buy box -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-start">
        <!-- Left: thumbnails + main image (cols 1-7) -->
        <div class="md:col-span-7 lg:col-span-7">
          <div class="flex gap-6">
            <!-- Thumbnails column (vertical) -->
            <div class="hidden md:flex flex-col gap-3">
              <!-- Only show single thumbnail (keeps structure for future images) -->
              <div class="thumb" onclick="swapImage('{{ product.image.url }}')">
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
              </div>
            </div>

            <!-- Main image -->
            <div class="flex-1 image-box">
              <img id="mainProductImage" src="{{ product.image.url }}" alt="{{ product.name }}">
            </div>
          </div>

          <!-- small top-rated pill -->
          <div class="mt-4">
            <span class="small-pill">Top Rated</span>
          </div>
        </div>

        <!-- Right: buy box (cols 8-12) -->
        <div class="md:col-span-5 lg:col-span-5">
          <div class="buy-box bg-white p-6 rounded-xl shadow-md border border-gray-100">
            <!-- Product title & short meta -->
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{{ product.name }}</h1>
            <p class="text-sm text-gray-500 mb-3 capitalize">{{ product.category }}</p>

            <!-- Price, availability -->
            <div class="flex items-center space-x-4 mb-5">
              <div>
                <div class="text-3xl font-extrabold text-slate-900">₹{{ product.price }}</div>
                {% if product.old_price %}
                <div class="text-sm text-gray-400 line-through">₹{{ product.old_price }}</div>
                {% endif %}
              </div>
              <div class="ml-auto text-sm">
                {% if product.available_stock > 0 %}
                  <span class="text-green-600 font-semibold">In stock</span>
                {% else %}
                  <span class="text-red-600 font-semibold">Out of stock</span>
                {% endif %}
              </div>
            </div>

            <!-- small highlights -->
            <ul class="muted text-sm mb-5 list-disc pl-5">
              <li>Free delivery on orders above ₹999</li>
              <li>7-day return policy</li>
              <li>Secure payments</li>
            </ul>

            <!-- CTA buttons -->
            <form method="POST" action="{% url 'add_to_cart' 'toy' product.id %}">
              {% csrf_token %}
              {% if user.is_authenticated %}
                <button type="submit" class="w-full toy-cta text-white px-6 py-3 rounded-lg hover:opacity-95 transition font-semibold shadow-sm mb-3">
                  Add to Cart
                </button>
                <a href="{% url 'add_to_wishlist' 'toy' product.id %}" class="w-full inline-block text-center border-2 border-pink-600 text-pink-600 px-6 py-3 rounded-lg hover:bg-pink-50 transition font-semibold mb-3">
                  Add to Wishlist
                </a>
                <button formaction="{% url 'buy_now' 'toy' product.id %}" class="w-full bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-semibold shadow-sm">
                  Buy Now
                </button>
              {% else %}
                <a href="/" class="block text-center bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                  Login to Buy
                </a>
              {% endif %}
            </form>

            <!-- small actions -->
            <div class="flex items-center gap-3 mt-4">
              <a href="{% url 'add_to_wishlist' 'toy' product.id %}" class="text-sm text-blue-600 hover:underline">Add to wishlist</a>
              <span class="text-sm text-gray-400">·</span>
              <a href="#product-details" class="text-sm text-gray-600 hover:underline">About this item</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Divider -->
      <div class="mt-10 border-t border-gray-200"></div>

      <!-- Product Details (About this item) -->
      <!-- Product Details (About this item) -->
<div id="product-details" class="mt-10">
  <div class="description-section p-8 rounded-xl shadow-sm">
    <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">About this item</h2>

    <!-- Collapsible wrapper -->
    <div class="relative">
      <div id="descWrapper" class="desc-wrapper max-h-72 overflow-hidden">
        <div class="description-content prose prose-slate prose-sm md:prose-base max-w-none text-gray-700">
          {% if product.description_html %}
            {% autoescape off %}
              {{ product.description_html }}
            {% endautoescape %}
          {% else %}
            <p class="desc-paragraph">{{ product.description }}</p>
          {% endif %}
        </div>
      </div>

      <!-- Fade effect -->
      <div id="fadeShadow" class="fade-bottom"></div>
    </div>

    <!-- Toggle Button -->
    <div class="mt-4">
      <button id="toggleBtn" class="text-blue-600 font-semibold hover:text-blue-800 transition">Show More ▾</button>
    </div>
  </div>
</div>


      <!-- Recommended / Related Products -->
      <section class="mt-12">
        <h3 class="text-xl font-semibold text-gray-900 mb-6">Customers also bought</h3>
        <div class="relative">
          <div id="related-scroll" class="flex gap-6 overflow-x-auto pb-4 scrollbar-hide">
            {% for related in related_products %}
              <a href="{% url 'toy_product_detail' related.id %}" class="min-w-[200px] md:min-w-[220px] snap-start bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition duration-300 overflow-hidden related-card">
                <div class="relative h-40 w-full overflow-hidden rounded-t-lg flex items-center justify-center">
                  <img src="{{ related.image.url }}" alt="{{ related.name }}" class="w-full h-full object-contain">
                </div>
                <div class="p-3">
                  <h4 class="font-semibold text-gray-900 text-sm leading-tight truncate">{{ related.name }}</h4>
                  <div class="text-sm text-pink-600 font-bold mt-2">₹{{ related.price }}</div>
                </div>
              </a>
            {% empty %}
              <p class="text-gray-500">No related products found.</p>
            {% endfor %}
          </div>
        </div>
      </section>
    </div>
  </section>

  {% include 'footer.html' %}

  <script>
    // Swap image (keeps single main image support)
    function swapImage(url) {
      const main = document.getElementById('mainProductImage');
      if (main) main.src = url;
    }

    // Related products scroll helpers
    function scrollProducts(direction) {
      const container = document.getElementById('related-scroll');
      if (!container) return;
      const scrollAmount = 300;
      container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
    }
  </script>

  <script>
(function(){
  const wrapper = document.getElementById("descWrapper");
  const btn = document.getElementById("toggleBtn");
  const fade = document.getElementById("fadeShadow");

  if (!wrapper || !btn) return;

  const COLLAPSED_MAX = 300; // px height

  function updateState() {
    if (wrapper.scrollHeight <= COLLAPSED_MAX) {
      btn.style.display = 'none';
      fade.style.display = 'none';
      wrapper.style.maxHeight = wrapper.scrollHeight + 'px';
    } else {
      btn.style.display = 'inline-block';
      fade.style.display = '';
      wrapper.style.maxHeight = COLLAPSED_MAX + 'px';
      btn.textContent = 'Show More ▾';
    }
  }

  updateState();

  btn.addEventListener('click', function(){
    if (wrapper.style.maxHeight === COLLAPSED_MAX + 'px') {
      wrapper.style.maxHeight = wrapper.scrollHeight + 'px';
      fade.style.display = 'none';
      btn.textContent = 'Show Less ▲';
    } else {
      wrapper.style.maxHeight = COLLAPSED_MAX + 'px';
      fade.style.display = '';
      btn.textContent = 'Show More ▾';
      wrapper.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  });

  window.addEventListener('resize', updateState);
})();
</script>

</body>
</html>
