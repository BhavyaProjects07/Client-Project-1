<script src="https://unpkg.com/alpinejs@3.12.0/dist/cdn.min.js" defer></script>


<header 
    x-data="navbar"
    class="sticky top-0 z-40 w-full transition-all duration-300 bg-white shadow-sm"
    :class="isScrolled ? 'shadow-md' : ''"
    @scroll.window="isScrolled = window.pageYOffset > 10"
    id="header">

    <div class="container mx-auto px-3 sm:px-4 py-3 sm:py-4">
      <div class="flex items-center justify-between gap-2 sm:gap-4">
        <!-- Logo -->
        <img src="https://res.cloudinary.com/dkfaom3zg/image/upload/v1763048642/logo_ujogun.png" alt="Sona Enterprises Logo" class="h-12 sm:h-13 w-auto cursor-pointer" onclick="window.location.href='/'">

        
        

        <!-- Navigation & Icons -->
        <div class="flex items-center gap-2 sm:gap-4 ml-auto">


          <!-- Hide navigation links on mobile, show only on md and above -->
          <nav class="hidden md:flex items-center gap-4 lg:gap-6">
            <a href="/">
              <div class="text-lg font-semibold text-black-700 hover:text-amber-800 transition">
               Home
              </div>
            </a>
            <a href="#women-products">
              <div class="text-lg font-semibold text-black-700 hover:text-amber-800 transition">
               Womens
              </div>
            </a>
            <a href="#electronics-products">
              <div class="text-lg font-semibold text-black-700 hover:text-amber-800 transition">
               Electronics
              </div>
            </a>
            <a href="#toys-products">
              <div class="text-lg font-semibold text-black-700 hover:text-amber-800 transition">
               Toys
              </div>
            </a>
          </nav>

          <!-- Wishlist -->
          <a href="{% url 'view_wishlist' %}">
            <button class="relative p-2 rounded-full hover:bg-gray-100 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
              {% if wishlist_count > 0 %}
              <span class="absolute -top-1 -right-1 h-4 w-4 flex items-center justify-center bg-amber-600 text-white text-xs rounded-full">
                {{ wishlist_count }}
              </span>
              {% endif %}
            </button>
          </a>


          <!-- Cart -->
          <a href="{% url 'view_cart' %}" class="relative p-2 rounded-full hover:bg-gray-100 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
            {% if user.is_authenticated %}
              <span class="absolute -top-1 -right-1 h-4 w-4 flex items-center justify-center bg-amber-600 text-white text-xs rounded-full">
                {{ request.user.cartitem_set.count }}
              </span>
            {% endif %}
          </a>

          <!-- Profile/Auth -->
<div class="relative inline-block text-left">
  {% if user.is_authenticated %}
    <!-- Dropdown for Authenticated User -->
    <button id="profile-button" class="p-2 rounded-full hover:bg-gray-100">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    </button>

    <div id="profile-menu" class="hidden absolute right-0 mt-2 w-72 max-w-[90vw] bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 overflow-hidden">

      <div class="max-h-64 overflow-y-auto px-4 py-3">

        <p class="text-sm font-medium text-gray-700">Welcome, {{ user.username }}</p>
        <hr class="my-2">
        <a href="{% url 'logout' %}" class="block text-sm text-blue-600 hover:underline">Logout</a>
        <a href="{% url 'my_orders' %}" class="block text-sm text-blue-700 hover:underline">Track My Orders</a>
        {% if user.is_staff %}
          <a href="{% url 'admin_dashboard' %}" class="text-sm text-amber-600 hover:underline">Admin Dashboard</a>
        {% endif %}
      </div>
    </div>

    {% else %}
  <!-- Dropdown for Unauthenticated User -->
  <div class="relative z-50 md:static flex justify-end w-full">

    <button id="signup-button" class="p-2 rounded-full hover:bg-gray-100">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    </button>

    <!-- Note: right-2 on mobile, right-0 on md+ -->
    <div id="signup-menu" class="hidden absolute right-2 md:right-0 mt-2 w-80 max-w-[90vw] bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50">

      <div class="px-4 py-3">
        <form method="post" action="{% url 'request_otp' %}" class="space-y-3">
          {% csrf_token %}
          <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
          <input type="text" name="username" required class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring focus:ring-blue-300">

          <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring focus:ring-blue-300">

          <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>

          <div class="relative">
              <input 
                  type="password" 
                  id="signup-password" 
                  name="password" 
                  required 
                  class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md text-sm focus:ring focus:ring-blue-300"
              >

              <!-- Eye Button (unique ids for signup to avoid collisions) -->
              <button 
                  type="button" 
                  onclick="toggleSignupPassword(this)" 
                  class="absolute inset-y-0 right-2 flex items-center text-gray-500"
                  aria-label="Toggle password visibility"
              >
                  <!-- eye icon -->
                  <svg id="signup-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
                      d="M1.5 12s4.5-7.5 10.5-7.5S22.5 12 22.5 12s-4.5 7.5-10.5 7.5S1.5 12 1.5 12z" />
                      <circle cx="12" cy="12" r="3" stroke-width="1.5" />
                  </svg>

                  <!-- closed eye icon -->
                  <svg id="signup-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
                      d="M3 3l18 18M9.88 9.88C9.33 10.41 9 11.16 9 12c0 1.66 1.34 3 3 3 .84 0 1.59-.33 2.12-.88M14.12 14.12l4.2 4.2M1.5 12S6 4.5 12 4.5c1.64 0 3.18.41 4.58 1.15M22.5 12c-.48.8-1.05 1.62-1.71 2.37" />
                  </svg>
              </button>
          </div>

          <button type="submit" class="w-full bg-amber-600 text-white text-sm font-semibold px-3 py-2 rounded-md hover:bg-blue-700 transition">
            Send OTP
          </button>

          <a href="{% url 'forgot_password' %}" 
            class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
            Forgot Password?
          </a>

        </form>
      </div>
    </div>
  </div>
{% endif %}

</div>

        <!-- Add hamburger menu button for mobile only -->
        <button id="hamburger-btn" class="md:hidden p-2 rounded-full hover:bg-gray-100 transition" @click="isMobileMenuOpen = !isMobileMenuOpen">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>

      <!-- Mobile Menu - slides in from right -->
      <div 
        x-show="isMobileMenuOpen" 
        @click.outside="isMobileMenuOpen = false"
        class="fixed inset-0 z-30 md:hidden"
        style="pointer-events: none;">
        <!-- Backdrop -->
        <div 
          x-show="isMobileMenuOpen"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-300"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="absolute inset-0 bg-black bg-opacity-30"
          @click="isMobileMenuOpen = false"
          style="pointer-events: all;"></div>

        <!-- Mobile Menu Panel - slides from right -->
        <div 
          x-show="isMobileMenuOpen"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="translate-x-full"
          x-transition:enter-end="translate-x-0"
          x-transition:leave="transition ease-in duration-300"
          x-transition:leave-start="translate-x-0"
          x-transition:leave-end="translate-x-full"
          class="absolute top-0 right-0 bottom-0 w-64 bg-white shadow-lg overflow-y-auto z-index-1000"
          style="pointer-events: all;">
          
          <div class="p-4">
            <!-- Close Button -->
            <button @click="isMobileMenuOpen = false" class="float-right p-2 hover:bg-gray-100 rounded-full transition mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <!-- Mobile Navigation Links - with right to left animation -->
            <nav class="flex flex-col gap-3 mt-6">
              <a href="/" @click="isMobileMenuOpen = false" class="px-3 py-2 text-base font-semibold text-black-700 hover:text-amber-800 hover:bg-amber-50 rounded transition transform hover:translate-x-1 duration-200">
                Home
              </a>
              <a href="#women-products" @click="isMobileMenuOpen = false" class="px-3 py-2 text-base font-semibold text-black-700 hover:text-amber-800 hover:bg-amber-50 rounded transition transform hover:translate-x-1 duration-200">
                Womens
              </a>
              <a href="#electronics-products" @click="isMobileMenuOpen = false" class="px-3 py-2 text-base font-semibold text-black-700 hover:text-amber-800 hover:bg-amber-50 rounded transition transform hover:translate-x-1 duration-200">
                Electronics
              </a>
              <a href="#toys-products" @click="isMobileMenuOpen = false" class="px-3 py-2 text-base font-semibold text-black-700 hover:text-amber-800 hover:bg-amber-50 rounded transition transform hover:translate-x-1 duration-200">
                Toys
              </a>
            </nav>

            <!-- Divider -->
            <hr class="my-4">

            <!-- Mobile Search -->
            
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div x-show="isMenuOpen" class="md:hidden mt-3 pb-3 border-t pt-3">
      </div>
    </div>
</header>

<!-- Initialize Alpine.js data for mobile menu state -->
<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('navbar', () => ({
      isMobileMenuOpen: false,
      isMenuOpen: false,
      isScrolled: false,
      init() {
            this.isMobileMenuOpen = false; // force close on load
        }
    }));
  });

  // Initialize header with Alpine.js if not already done
  const header = document.getElementById('header');
  if (header && !header.__x) {
    Alpine.initTree(header);
  }


  function toggleSignupPassword(btn) {
    // find the closest form block and the password input within it
    const container = btn.closest('.px-4') || btn.closest('.relative') || document;
    const field = container.querySelector('#signup-password');
    const eyeOpen = container.querySelector('#signup-eye-open');
    const eyeClosed = container.querySelector('#signup-eye-closed');

    if (!field) return;

    if (field.type === "password") {
      field.type = "text";
      if (eyeOpen) eyeOpen.classList.add("hidden");
      if (eyeClosed) eyeClosed.classList.remove("hidden");
    } else {
      field.type = "password";
      if (eyeOpen) eyeOpen.classList.remove("hidden");
      if (eyeClosed) eyeClosed.classList.add("hidden");
    }
  }
</script>



